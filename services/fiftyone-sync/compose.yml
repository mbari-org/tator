# Separate MongoDB per project (mongo on 27017, mongo2 on 27018). Per-project databases within each.
# Set FIFTYONE_DATABASE_URI to override (single shared URI). Set FASTVSS_API_URL when running
# fiftyone-sync API/worker (embedding service base URL, e.g. http://localhost:8000).
#
# Usage: docker compose -f compose.yml up -d
#
# Background sync (Redis): To keep the UI responsive when syncing millions of localizations,
# use the Tator stack's Redis. Set REDIS_HOST=redis (and same network as Tator) for the API,
# and run the sync worker (e.g. python sync_worker.py) with REDIS_HOST=redis. See README.

services:
  mongo1:
    image: mongo
    container_name: mongo-fiftyone-1
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data1:/data/db
    command: --dbpath /data/db --port 27017 --bind_ip_all
    restart: always
    networks:
      - voxel51

  mongo2:
    image: mongo
    container_name: mongo-fiftyone-2
    ports:
      - "27018:27018"
    volumes:
      - mongodb_data2:/data/db
    command: --dbpath /data/db --port 27018 --bind_ip_all
    restart: always
    networks:
      - voxel51

networks:
  voxel51:
    name: voxel51

volumes:
  mongodb_data1:
    driver: local
  mongodb_data2:
    driver: local
